<Project>

    <Import Project="Tomat.Sisyphus.GamePath.targets"/>

    <UsingTask TaskName="AssemblyResolutionTask"
               AssemblyFile="Sisyphus.Build.dll"/>

    <!-- Set general build properties understood to be good defaults for any
         mods using sisyphus. -->
    <PropertyGroup>
        <DebugSymbols>true</DebugSymbols>
        <ProduceReferenceAssembly>false</ProduceReferenceAssembly>
    </PropertyGroup>

    <!-- Install launchSettings.json -->
    <!--<Target Name="InstallLaunchSettings" BeforeTargets="Build">
        <PropertyGroup>
            <LaunchSettings>
                {
                "profiles": {
                "ULTRAKILL": {
                "commandName": "Executable",
                "executablePath": "%24%28GameRunPath%29",
                "workingDirectory": "%24%28GamePath%29"
                }
                }
            </LaunchSettings>
        </PropertyGroup>

        <Message Importance="High" Text="GamePath: $(GamePath)"/>
        <Message Importance="High" Text="LaunchSettings: $(LaunchSettings)"/>

        <WriteLinesToFile File="$(MSBuildProjectDirectory)/Properties/launchSettings.json" Overwrite="true" Lines="$(LaunchSettings)"/>
    </Target>-->
    
    <!-- TODO: Cross-OS support. -->
    <PropertyGroup Condition="'$(OS)' == 'Windows_NT'">
        <StartAction>Program</StartAction>
        <StartProgram>$(GameRunPath)</StartProgram>
        <StartWorkingDirectory>$(GamePath)</StartWorkingDirectory>
    </PropertyGroup>

    <Target Name="AddAssemblies" BeforeTargets="ResolveAssemblyReferences">
        <AssemblyResolutionTask InputPath="$(GamePath)/ULTRAKILL_Data/Managed">
            <Output TaskParameter="Assemblies" ItemName="_Assemblies"/>
        </AssemblyResolutionTask>
        <ItemGroup>
            <!-- TODO: Don't copy these? pl0x -->
            <Reference Include="@(_Assemblies)"/>
        </ItemGroup>
    </Target>

</Project>